- [デバイスとは](#デバイスとは)
- [I/Oデバイス](#ioデバイス)
- [デバイスコントローラー](#デバイスコントローラー)
  - [はたらき](#はたらき)
- [デバイスの繋がり](#デバイスの繋がり)
- [ダイレクトメモリアクセス](#ダイレクトメモリアクセス)
- [ポーリングと割り込みIO](#ポーリングと割り込みio)


## デバイスとは
- デバイスとは、キーボード、マウス、プリンターなどのこと。
  - キーボードやマウスなどは入力デバイスで、プリンターなどは出力デバイス。
- 物理的な機械コンポーネント（物理的な機械的な部分）と電子コンポーネント（電子的な制御部分）から成り立つI/Oユニットとも表現する。


## I/Oデバイス
ブロックデバイス
ブロックデバイスは、ドライバーがデータのブロック全体を送信することによって通信するデバイスです。たとえば、ハードディスク、USB カメラ、ディスクオンキーなどです。

キャラクターデバイス-
キャラクターデバイスは、ドライバーが単一の文字（バイト、オクテット）を送受信することによって通信するデバイスです。たとえば、シリアル ポート、パラレル ポート、サウンド カードなど


## デバイスコントローラー
- デバイスの電子コンポーネントには、デバイスを操作し、データの送受信を制御するための回路やチップが含まれる。
  - これはデバイスコントローラーと呼ばれる
- デバイスドライバーがコンピューターシステムとデバイスとの間で正確にデータを送受信できるように仲介し、相互に通信を可能にします。
  - PCに繋げた時、プリンターを動作させるなど
- 物理的なデバイスとコンピューターシステムの間に存在し、それぞれの機械的な特性や電子的な信号を適切に取り扱うインターフェイスを提供する
  - デバイスがコンピューターのOSに対応する場合、「互換性がある」と表現される

### はたらき
- シリアルビットストリームをバイトのブロックに変換する
  - 連続したビット列を8ビット毎のバイト列に変換する
- 必要に応じてエラー訂正を実行する

## デバイスの繋がり
コンピュータに接続されているデバイスは、相互に通信できるようにプラグとソケットで接続されています。ここでのソケットは、それぞれのデバイスがデバイスコントローラに接続されるためのインターフェースを指します。デバイスコントローラは、コンピュータ内のデバイスを管理し、制御する役割を果たします。

以下は、CPU（Central Processing Unit）、メモリ、コントローラ、およびI/Oデバイスを接続するための一般的なモデルです。

1. **CPU（中央演算処理装置）：**
   - コンピュータの頭脳であり、プログラムの実行や演算を担当します。
   - デバイスと通信するために、共通の通信バスを使用します。

2. **メモリ：**
   - プログラムやデータの一時的な保存場所であり、CPUがアクセスして情報を読み書きします。
   - CPUと同様に、共通の通信バスを介してデバイスと連携します。

3. **コントローラ：**
   - デバイスコントローラは、異なるデバイスを管理し、それらが正しく機能するように制御します。
   - プラグとソケットのインターフェースを通じて各デバイスが接続され、コントローラを介してデータや指示がやり取りされます。

4. **I/Oデバイス：**
   - 入力や出力を担当するデバイスで、例えばキーボード、マウス、プリンタなどが該当します。
   - デバイスコントローラを介してCPUと通信し、必要なデータのやり取りが行われます。

- 全てのデバイスは、デバイスコントローラを介してコンピュータと連携し、共通のバスを通じて情報をやり取りします。
  - バスとは
    - コンピュータ内部でデータや制御信号が転送される経路や通信チャネルのこと
    - データバス、アドレスバス、制御バス、etc.

このような構造により、各デバイスは効率的に協力してコンピュータの機能を実現することができます。


## ダイレクトメモリアクセス
低速デバイスと割り込み:
    低速デバイス（例: キーボード）は、データをメインのCPUに送る際に、各バイトが転送された後に割り込み信号を生成します。
    割り込みは、CPUに「ちょっと待って、ここにデータが来たよ」と通知する方法です。

高速デバイスと割り込みの問題:
    高速デバイス（例: ディスク）がバイトごとに割り込みを生成すると、オペレーティング システムはその都度割り込みを処理しなければなりません。
    これが続くと、オペレーティング システムはほとんどの時間をこれらの割り込み処理に費やすことになり、他の処理が遅れる可能性があります。

ダイレクト メモリ アクセス (DMA) の導入:
    一般的なコンピュータは、ダイレクト メモリ アクセス（DMA）ハードウェアを使用して、この割り込み処理のオーバーヘッドを削減します。
    DMAは、デバイスとメモリ間でデータを転送するために、CPUの介在なしにメモリへのアクセスを可能にします。
    これにより、高速デバイスがデータをメモリに直接転送し、CPUはその間に他の処理を行うことができます。

簡単に言えば、低速デバイスはデータを送るたびに割り込みを発生させますが、
高速デバイスの場合、ダイレクト メモリ アクセスを利用して割り込みのオーバーヘッドを軽減し、CPUが他の仕事に専念できるようにしています。

## ポーリングと割り込みIO
ポーリング
- デバイスのステータスを定期的にチェックして、次の I/O 操作の時期が来たかどうかを確認するプロセス
- 教師がクラスの生徒全員に次々と助けが必要かどうか尋ね続けるようなもので、非効率
  - 生徒がサポートが必要なときにいつでも教師に通知するのが、割り込み駆動方式

割り込み駆動方式
- デバイス コントローラは、CPU が割り込みを受信したときに CPU の注意が必要な場合、バス上に割り込み信号を送る。
- 現在の状態を保存し、割り込みベクトル (さまざまなイベントを処理するための OS ルーチンのアドレス) を使用して適切な割り込みハンドラーを呼び出す。
- 割り込みデバイスが処理されると、CPU は割り込みがなかったかのように元のタスクを続行する。

