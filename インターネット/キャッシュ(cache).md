- [キャッシュのメリット・デメリット](#キャッシュのメリットデメリット)
  - [メリット](#メリット)
  - [デメリット](#デメリット)
- [クライエントキャッシュ（client cache）](#クライエントキャッシュclient-cache)
  - [キャッシュの種類](#キャッシュの種類)
    - [プライベートキャッシュ](#プライベートキャッシュ)
    - [共有キャッシュ](#共有キャッシュ)
      - [プロキシキャッシュ（proxy cache）](#プロキシキャッシュproxy-cache)
      - [マネージドキャッシュ（managed cache）](#マネージドキャッシュmanaged-cache)
    - [ヒューリスティックキャッシュ](#ヒューリスティックキャッシュ)
  - [キャッシュの状態](#キャッシュの状態)
    - [キャッシュの更新](#キャッシュの更新)
  - [キャッシュしない](#キャッシュしない)
    - [キャッシュを他人と共有しないようにする](#キャッシュを他人と共有しないようにする)
    - [常に最新のコンテンツを提供する](#常に最新のコンテンツを提供する)
  - [再読み込みと強制再読み込み](#再読み込みと強制再読み込み)
    - [再読み込みの回避](#再読み込みの回避)
- [サーバサイドキャッシュ](#サーバサイドキャッシュ)
  - [redis](#redis)


## キャッシュの特徴
### キャッシュとは
1. アプリ、サーバー、Web サイト、またはブラウザーからの一時ファイルまたはデータを保存し、要求されたときに読み込みを高速化するために予約されているメモリ

### メリット
1. ハードディスクアクセスへの遅延を軽減
   1. ストレージでアクセスされるのは、一部のみである。
   2. 一部のみをキャッシュに保存すればよい。

### デメリット
1. データの整合性のリスク
2. データの鮮度
   1. 保存済みのデータが古くなる。
3. ウォームアップが必要
   1. 起動後にキャッシュへデータを読み込む必要がある。

## クライエントキャッシュ（client cache）
httpヘッダーでキャッシュは操作する。

Cache-Control

オプション：
max-age

https://developer.mozilla.org/ja/docs/Web/HTTP/Caching

### キャッシュの種類
#### プライベートキャッシュ

#### 共有キャッシュ
##### プロキシキャッシュ（proxy cache）
ローカルネットワークとインターネットの間に設置されているプロキシサーバーに保存されているデータのこと。


##### マネージドキャッシュ（managed cache）
サービス開発者が元サーバの負荷を分散するために追加するもの。
HTTPキャッシュに比べ、操作の幅があり自由度が高い。

#### ヒューリスティックキャッシュ
一応、自動キャッシュの機能はある。
`Cache-Control`を指定しなくても、更新がないコンテンツは自動でキャッシュされる。
ただし、基本は`Cache-Control`を指定する。

#### その他
1. ブラウザリクエストキャッシュ
2. Javascript/AJAX キャッシュ
   1.
3. HTML 5 キャッシュ


### クライエントキャッシュのメリット・デメリット
1. ブラウザ固有であること
   1. 複数ブラウザを使用すると、キャッシュも複数存在させる必要がある。
2. サーバー側キャッシュよりも複雑


### キャッシュの状態
`age`はレスポンスの鮮度を示す。
`age`はネットワークパケットのTTL(Time To Live)に似ている。
`max-age`で期限を決めれる。

> ◆ コラム
> HTTP/1.0時代は、`Expires`というプロパティで期限日時を指定していた。
> ただ、多くのバグや脆弱性があり、`age`で秒数を返すようになった。

#### キャッシュの更新
- `age`が期限切れになると、コンテンツが更新されたかどうか`検証`を行う。
- `If-Modified-Since`または`If-None-Match`というリクエストが含まれた軽量なリクエスト/レスポンスで通信する。
  - `304`ステータスが返ると、変更されていないことを示す。
- `no-cache`ディレクティブで更新を強制できる。

### キャッシュしない
- 単純にキャッシュを停止するなら、`no-store`ディレクティブで実現できる。
- ただし、キャッシュしないという要件はもう少し柔軟な対応が必要である。
- `no-store`だとHTTP とブラウザーが持つ多くの利点を失うので、工夫するべき。

#### キャッシュを他人と共有しないようにする
`no-store`とともに`private`も設定する。
```
Cache-Control: private
```
```
Cache-Control: no-store, private
```


#### 常に最新のコンテンツを提供する
下記のように設定する。
```
Cache-Control: no-cache
```

`no-store`だと毎回リクエストするが、`no-cache`であれば検証を行い、更新が合った時のみ再リクエストする。


### 再読み込みと強制再読み込み
検証はレスポンスだけでなく、リクエストに対しても行うことができます。

#### 再読み込みの回避
変更されることのないコンテンツは、`immutable`ディレクティブで再読み込みを回避できる。
```
Cache-Control: max-age=31536000, immutable
```


## サーバサイドキャッシュ
1. Object cache
   1. データベース クエリを保存します。その結果、次回リクエストが行われたときのアクセスが容易になります。
2. OpCode cache
   1. phpバイトコードをキャッシュする
3. CDNキャッシュ
4.

### redis
